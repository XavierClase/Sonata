import{A as $,p as v,H as f,M as Z,C as G,D as I,w as J,o as _,b as L,h as e,k as m,x as A,v as d,Z as V,L as U,t as F,F as T,i as K,n as Q,O as D,_ as M,P as W,$ as X,a0 as Y,f as aa}from"./app-BArZ-JoB.js";function ka(){const i=$(),t=v(new Set),c=v([]);return{mostrarFavoritosCanciones:async()=>{if(i.user)try{const n=await f.get("/api/mostrar/cancion/likes");console.log("Response:",n),c.value=n.data.data,console.log("favs: ",c.value)}catch(n){console.error("Error al cargar favoritos",n)}},cancionesFavoritas:t,cancionesFavoritasMostrar:c,cargarFavoritosCanciones:async()=>{if(i.user)try{const n=await f.get("/api/cancion/likes");t.value=new Set(n.data.favoritos)}catch(n){console.error("Error al cargar favoritos",n)}},toggleLikeCancion:async n=>{if(!i.user){console.warn("El usuario no está autenticado");return}try{const u=await f.post(`/api/like/cancion/${n}`);t.value=new Set(u.data.favoritos)}catch(u){console.error("Error al dar/quitar like",u)}},esFavoritaCancion:n=>t.value.has(n)}}function Ea(){const i=$(),t=v(new Set);return{favoritos:t,toggleLike:async p=>{if(!i.user){console.warn("El usuario no está autenticado");return}try{const r=await f.post(`/api/like/album/${p}`);t.value=new Set(r.data.favoritos)}catch(r){console.error("Error al dar/quitar like",r)}},esFavorito:async p=>{if(!i.user)return console.warn("El usuario no está autenticado"),!1;try{const r=await f.get(`/api/album/favorito/${p}`);return console.log(r.data),r.data.es_favorito}catch(r){return console.error("Error al comprobar si el álbum es favorito",r),!1}}}}function xa(){const i=$(),t=v(new Set);return{favoritos:t,toggleLike:async p=>{if(!i.user){console.warn("El usuario no está autenticado");return}try{const r=await f.post(`/api/like/lista/${p}`);t.value=new Set(r.data.favoritos)}catch(r){console.error("Error al dar/quitar like",r)}},esFavorito:async p=>{if(!i.user)return console.warn("El usuario no está autenticado"),!1;try{const r=await f.get(`/api/lista/favorito/${p}`);return console.log(r.data),r.data.es_favorito}catch(r){return console.error("Error al comprobar si el álbum es favorito",r),!1}}}}function sa(){const i=v(!1),t=v(null),c=v([]),g=v([]);return{listas:c,cancionesLista:g,loading:i,error:t,fetchListasUsuario:async u=>{i.value=!0,t.value=null;try{const l=await f.get(`/api/listas/usuario/${u}`);c.value=l.data.data}catch(l){t.value="Error al cargar las listas",console.error(l)}finally{i.value=!1}},crearLista:async u=>{i.value=!0,t.value=null;try{const l=new FormData;Object.keys(u).forEach(C=>{l.append(C,u[C])});const y=await f.post("/api/listas",l,{headers:{"Content-Type":"multipart/form-data"}});return c.value.push(y.data.lista),y.data.lista}catch(l){t.value="Error al crear la lista",console.error(l)}finally{i.value=!1}},fetchCancionesLista:async u=>{i.value=!0,t.value=null;try{const l=await f.get(`/api/listas/${u}/canciones`);g.value=l.data.data}catch(l){t.value="Error al cargar las canciones de la lista",console.error(l)}finally{i.value=!1}},añadirCancionALista:async(u,l)=>{i.value=!0,t.value=null;try{return(await f.post("/api/listas/añadirCancion",{lista_ids:u,cancion_id:l})).data}catch(y){throw t.value="Error al añadir canción a la lista",console.error(y),y}finally{i.value=!1}}}}const ea={class:"lista-canciones-container"},oa={class:"crear-lista-y-busqueda"},ta={class:"crear-lista"},ra={class:"busqueda-listas"},ia={key:0,class:"cargando"},na={key:1,class:"error"},la={class:"color_texto"},ca={key:2,class:"sin_listas"},ua={key:3,class:"sin_listas"},da={key:4,class:"listas_caja"},va=["onClick"],pa={class:"lista_portada"},fa=["src"],ma={class:"informacion_lista"},ga={class:"nombre_lista"},ya={class:"nombre_lista_texto"},ba={class:"detalle_lista"},_a={class:"lista_Ncancion"},La={class:"duracion_lista"},wa={class:"añadir-cancion-seccion"},ha={class:"flex flex-column gap-3"},Fa={__name:"listaCanciones",props:{cancion:{type:Object,default:null}},emits:["close"],setup(i,{emit:t}){const c=Z(),g=i,p=t,r=$().user.id,h=v(""),{listas:n,loading:u,error:l,fetchListasUsuario:y,crearLista:C,añadirCancionALista:B}=sa(),k=v(!0),E=v(!1),b=v([]),w=v({nombre:"",descripcion:"",portada:null}),N=G(()=>h.value?n.value.filter(s=>s.nombre.toLowerCase().includes(h.value.toLowerCase())):n.value),O=s=>{let a=s.portada;return new URL(a,import.meta.url).href},j=s=>s,P=s=>{w.value.portada=s.files[0]},R=s=>{if(q(s)){c.add({severity:"warn",summary:"Canción duplicada",detail:"Esta canción ya está en la lista",life:3e3});return}const a=b.value.indexOf(s);a>-1?b.value.splice(a,1):b.value.push(s)},z=async()=>{try{const s=await C({...w.value,duracion_total:"00:00:00"});s&&(c.add({severity:"success",summary:"Lista creada",detail:"Tu lista se ha creado correctamente",life:3e3}),await y(r),E.value=!1,b.value.push(s.id),w.value={nombre:"",descripcion:"",portada:null})}catch{c.add({severity:"error",summary:"Error",detail:"No se pudo crear la lista",life:3e3})}},H=async()=>{if(g.cancion&&b.value.length>0)try{const s=await B(b.value,g.cancion.id);s.duplicados.length>0&&c.add({severity:"warn",summary:"Canciones duplicadas",detail:`La canción ya existe en ${s.duplicados.length} listas`,life:5e3}),s.exitosas.length>0&&c.add({severity:"success",summary:"Éxito",detail:`Canción añadida a ${s.exitosas.length} listas`,life:3e3}),k.value=!1,b.value=[]}catch{c.add({severity:"error",summary:"Error",detail:"No se pudo añadir la canción",life:3e3})}},q=s=>{var x;const a=n.value.find(o=>o.id===s);return(x=a==null?void 0:a.canciones)==null?void 0:x.some(o=>{var S;return o.id===((S=g.cancion)==null?void 0:S.id)})};return I(async()=>{await y(r)}),J(k,s=>{s||p("close")}),(s,a)=>{const x=aa("Toast");return _(),L(T,null,[a[15]||(a[15]=e("div",{class:"show"},null,-1)),m(x,{position:"top-right"}),m(d(M),{visible:k.value,"onUpdate:visible":a[5]||(a[5]=o=>k.value=o),header:"Añadir a Lista",modal:"",class:"lista-canciones-dialog",appendTo:".show"},{default:A(()=>[e("div",ea,[e("div",oa,[e("div",ta,[m(d(V),{label:"Nueva Lista",onClick:a[0]||(a[0]=o=>E.value=!0),class:"crear_album_boton",title:"Crear una lista nueva"})]),e("div",ra,[m(d(U),{modelValue:h.value,"onUpdate:modelValue":a[1]||(a[1]=o=>h.value=o),placeholder:"Buscar listas...",class:"input-busqueda"},null,8,["modelValue"]),a[6]||(a[6]=e("i",{class:"pi pi-search icono-busqueda"},null,-1))])]),d(u)?(_(),L("div",ia,a[7]||(a[7]=[e("p",{class:"color_texto"},"Cargando listas...",-1)]))):d(l)?(_(),L("div",na,[e("p",la,F(d(l)),1)])):d(n).length===0?(_(),L("div",ca,a[8]||(a[8]=[e("p",{class:"color_texto"},"No tienes listas creadas aún.",-1)]))):N.value.length===0?(_(),L("div",ua,a[9]||(a[9]=[e("p",{class:"color_texto"},"No se encontraron listas que coincidan con la búsqueda",-1)]))):(_(),L("div",da,[(_(!0),L(T,null,K(N.value,o=>(_(),L("div",{key:o.id,class:Q(["listas_items",{"lista-seleccionada":b.value.includes(o.id),"lista-duplicada":q(o.id)}]),onClick:S=>R(o.id)},[e("div",pa,[e("img",{src:O(o),alt:"Portada de la lista",class:"imagen-portada"},null,8,fa)]),e("div",ma,[e("div",ga,[e("p",ya,F(o.nombre),1)]),e("div",ba,[e("p",_a,[a[10]||(a[10]=e("i",{class:"pi pi-music"},null,-1)),D(" "+F(o.num_canciones||0)+" canciones ",1)]),e("p",La,[a[11]||(a[11]=e("i",{class:"pi pi-clock"},null,-1)),D(" "+F(j(o.duracion_total||"00:00")),1)])])])],10,va))),128))])),e("div",wa,[m(d(V),{label:"Añadir",onClick:H,disabled:b.value.length===0,class:"boton-añadir-cancion",title:"Añadir la canción a las listas seleccionadas"},null,8,["disabled"])]),m(d(M),{visible:E.value,"onUpdate:visible":a[4]||(a[4]=o=>E.value=o),header:"Crear Nueva Lista",modal:"",class:"modal-crear-lista"},{default:A(()=>[e("form",{onSubmit:W(z,["prevent"])},[e("div",ha,[a[12]||(a[12]=e("label",{for:"nombre"},"Nombre de la Lista",-1)),m(d(U),{id:"nombre",modelValue:w.value.nombre,"onUpdate:modelValue":a[2]||(a[2]=o=>w.value.nombre=o),required:"",class:"input-dialog-listas-cancion"},null,8,["modelValue"]),a[13]||(a[13]=e("label",{for:"descripcion"},"Descripción (opcional)",-1)),m(d(X),{id:"descripcion",modelValue:w.value.descripcion,"onUpdate:modelValue":a[3]||(a[3]=o=>w.value.descripcion=o),rows:"3",class:"input-dialog-listas-cancion"},null,8,["modelValue"]),a[14]||(a[14]=e("label",{for:"portada"},"Portada de la Lista",-1)),m(d(Y),{mode:"basic",name:"portada",url:"./upload",accept:"image/*",onSelect:P,chooseLabel:"Seleccionar imagen"}),m(d(V),{type:"submit",label:"Crear",class:"crear_album_boton"})])],32)]),_:1},8,["visible"])])]),_:1},8,["visible"])],64)}}};export{Fa as _,ka as a,xa as b,Ea as u};
