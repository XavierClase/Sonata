import{M as D,R as M,p as t,C as U,D as R,b as i,h as o,P as F,k as d,n as v,v as r,t as m,e as p,x as P,O as j,o as u,L as h,Z as b,I as B}from"./app-BArZ-JoB.js";import{u as I}from"./cancionesAdmin-DfvjdQrT.js";import{u as O}from"./albumesAdmin-wFGr6eia.js";import{s as T}from"./index-DBkJWd5m.js";const W={class:"card"},z={class:"card-body"},G={class:"field col-12 md:col-6"},Z={key:0,class:"p-error"},q={class:"field col-12 md:col-6"},H={key:0,class:"p-error"},J={class:"field col-12 md:col-6"},K={class:"flex align-items-center"},Q={key:0,class:"p-error"},X={class:"field col-12"},Y={class:"flex flex-column gap-2"},ee=["value"],oe={key:0,class:"mt-2"},ae=["src","type"],le={key:1,class:"p-error"},se={class:"flex justify-content-end col-12"},ue={__name:"Create",setup(ne){const _=B();D();const{storeCancion:C,errors:V,loading:f}=I(),{albumes:k,getAlbumes:x}=O(),l=M({nombre:"",duracion:"",album_id:null,archivo:null});t([]);const w=U(()=>k.value.data.map(n=>({id:n.id,nombre:n.nombre}))),a=t({}),g=t(""),c=t(null),y=t(""),A=t(null),S=n=>{const e=n.target.files[0];e&&(l.archivo=e,g.value=e.name,y.value=e.type,c.value&&URL.revokeObjectURL(c.value),c.value=URL.createObjectURL(e))},E=n=>{const e=n.target;if(e&&e.duration){const s=Math.floor(e.duration),N=Math.floor(s/60),$=s%60;l.duracion=`${N.toString().padStart(2,"0")}:${$.toString().padStart(2,"0")}`}},L=async()=>{if(a.value={},l.nombre||(a.value.nombre=["El nombre de la canción es obligatorio"]),l.duracion||(a.value.duracion=["Debe cargar un archivo de audio para detectar la duración"]),l.album_id||(a.value.album_id=["Debe seleccionar un álbum"]),l.archivo||(a.value.archivo=["Debe seleccionar un archivo de audio"]),!(Object.keys(a.value).length>0))try{console.log("Enviando formulario:",l),await C(l),_.push("/admin/canciones")}catch(n){console.error("Error al guardar la canción:",n),a.value=V.value}};return R(()=>{x()}),(n,e)=>(u(),i("div",W,[e[13]||(e[13]=o("h5",{class:"card-header bg-transparent ps-0 pe-0"},"Crear Nueva Canción",-1)),o("div",z,[o("form",{onSubmit:F(L,["prevent"]),class:"formgrid grid"},[o("div",G,[e[5]||(e[5]=o("label",{for:"nombre",class:"font-bold"},"Nombre de la Canción*",-1)),d(r(h),{id:"nombre",modelValue:l.nombre,"onUpdate:modelValue":e[0]||(e[0]=s=>l.nombre=s),class:v([{"p-invalid":a.value.nombre},"w-full"]),placeholder:"Ingrese el nombre de la canción"},null,8,["modelValue","class"]),a.value.nombre?(u(),i("small",Z,m(a.value.nombre[0]),1)):p("",!0)]),o("div",q,[e[6]||(e[6]=o("label",{for:"duracion",class:"font-bold"},"Duración*",-1)),d(r(h),{id:"duracion",modelValue:l.duracion,"onUpdate:modelValue":e[1]||(e[1]=s=>l.duracion=s),class:v([{"p-invalid":a.value.duracion},"w-full"]),placeholder:"00:00",readonly:""},null,8,["modelValue","class"]),a.value.duracion?(u(),i("small",H,m(a.value.duracion[0]),1)):p("",!0),e[7]||(e[7]=o("small",{class:"text-gray-500"},"La duración se detectará automáticamente al cargar el archivo de audio",-1))]),o("div",J,[e[8]||(e[8]=o("label",{for:"album_id",class:"font-bold"},"Álbum*",-1)),d(r(T),{id:"album_id",modelValue:l.album_id,"onUpdate:modelValue":e[2]||(e[2]=s=>l.album_id=s),options:w.value,optionLabel:"nombre",optionValue:"id",placeholder:"Seleccione un álbum",class:v(["w-full",{"p-invalid":a.value.album_id}]),filter:"",filterPlaceholder:"Buscar álbum...",showClear:!0},{option:P(s=>[o("div",K,[o("span",null,m(s.option.nombre),1)])]),_:1},8,["modelValue","options","class"]),a.value.album_id?(u(),i("small",Q,m(a.value.album_id[0]),1)):p("",!0)]),o("div",X,[e[12]||(e[12]=o("label",{for:"archivo",class:"font-bold"},"Archivo de Audio (MP3/WAV)*",-1)),o("div",Y,[o("div",{class:v(["p-inputgroup",{"border-red-500 rounded-md":a.value.archivo}])},[e[9]||(e[9]=o("span",{class:"p-inputgroup-addon"},[o("i",{class:"pi pi-music"})],-1)),o("input",{type:"text",readonly:"",class:"p-inputtext p-component w-full",value:g.value||"Ningún archivo seleccionado"},null,8,ee),d(r(b),{type:"button",label:"Examinar",onClick:e[3]||(e[3]=s=>n.$refs.audioFileInput.click()),severity:"secondary"})],2),o("input",{ref:"audioFileInput",type:"file",style:{display:"none"},onChange:S,accept:".mp3,.wav"},null,544),c.value?(u(),i("div",oe,[o("audio",{ref_key:"audioElement",ref:A,controls:"",class:"w-full",onLoadedmetadata:E},[o("source",{src:c.value,type:y.value},null,8,ae),e[10]||(e[10]=j(" Tu navegador no soporta el elemento de audio. "))],544)])):p("",!0),a.value.archivo?(u(),i("small",le,m(a.value.archivo[0]),1)):p("",!0),e[11]||(e[11]=o("small",{class:"text-gray-500"},"Formatos permitidos: MP3, WAV",-1))])]),o("div",se,[d(r(b),{type:"button",label:"Cancelar",icon:"pi pi-times",class:"p-button-secondary mr-2",onClick:e[4]||(e[4]=s=>n.$router.push("/admin/canciones")),disabled:r(f)},null,8,["disabled"]),d(r(b),{type:"submit",label:"Guardar",icon:"pi pi-save",loading:r(f)},null,8,["loading"])])],32)])]))}};export{ue as default};
