import{M as T,p as u,D as V,b as d,h as o,P as E,k as m,n as M,t as y,e as v,O as b,v as U,f as C,o as c,l as j,I as A}from"./app-BArZ-JoB.js";import{u as B}from"./cancionesAdmin-DfvjdQrT.js";const N={class:"grid"},O={class:"col-12"},$={class:"card"},I={class:"card-body"},F={class:"field mb-4"},H={key:0,class:"p-error"},P={class:"field mb-4"},z={class:"p-inputtext p-component p-disabled"},G={key:0,class:"ml-2 text-info"},q={class:"field mb-4"},J={key:0,class:"mt-2"},K={controls:"",class:"w-100",style:{height:"30px"}},Q=["src"],W={key:1,class:"mt-2"},X={controls:"",class:"w-100",style:{height:"30px"}},Y=["src"],Z={class:"flex justify-content-end"},ta={__name:"Edit",setup(aa){const f=j(),h=A(),w=T(),{getCancion:x,updateCancion:k,errors:oa,loading:D}=B(),l=u({}),i=u({}),t=u(""),r=u(null),s=u({nombre:"",duracion:"",archivo:null}),L=async()=>{try{const e=await x(f.params.id);l.value=e,s.value={nombre:e.nombre,duracion:e.duracion,archivo:null}}catch{w.add({severity:"error",summary:"Error",detail:"Error al cargar la canción",life:3e3}),h.push("/admin/canciones")}},p=e=>{const a=Math.floor(e/60),n=Math.floor(e%60);return`${String(a).padStart(2,"0")}:${String(n).padStart(2,"0")}`},R=e=>{const a=e.target.files[0];if(a){s.value.archivo=a,t.value&&URL.revokeObjectURL(t.value),t.value=URL.createObjectURL(a);const n=new Audio;n.src=t.value,n.addEventListener("loadedmetadata",()=>{r.value=n.duration,s.value.duracion=p(n.duration)})}else s.value.archivo=null,t.value&&(URL.revokeObjectURL(t.value),t.value=""),r.value=null},S=async()=>{i.value={};try{const e=new FormData;e.append("nombre",s.value.nombre),r.value?e.append("duracion",p(r.value)):e.append("duracion",l.value.duracion),s.value.archivo instanceof File&&e.append("archivo",s.value.archivo),await k(f.params.id,e),h.push("/admin/canciones")}catch(e){e.response&&e.response.status===422&&(i.value=e.response.data.errors)}};return V(()=>{L()}),(e,a)=>{const n=C("InputText"),_=C("Button");return c(),d("div",N,[o("div",O,[o("div",$,[a[10]||(a[10]=o("div",{class:"card-header bg-transparent ps-0 pe-0"},[o("h5",{class:"float-start mb-0"},"Editar Canción")],-1)),o("div",I,[o("form",{onSubmit:E(S,["prevent"]),class:"p-fluid"},[o("div",F,[a[2]||(a[2]=o("label",{for:"nombre"},"Nombre de la canción",-1)),m(n,{id:"nombre",modelValue:s.value.nombre,"onUpdate:modelValue":a[0]||(a[0]=g=>s.value.nombre=g),class:M(["w-full",{"p-invalid w-100":i.value.nombre}])},null,8,["modelValue","class"]),i.value.nombre?(c(),d("small",H,y(i.value.nombre[0]),1)):v("",!0)]),o("div",P,[a[3]||(a[3]=o("label",{for:"duracion"},"Duración",-1)),o("div",z,[b(y(r.value?p(r.value):l.value.duracion)+" ",1),r.value?(c(),d("span",G,"(Duración calculada del nuevo archivo)")):v("",!0)])]),o("div",q,[a[8]||(a[8]=o("label",{for:"archivo"},"Archivo de audio",-1)),o("input",{type:"file",onChange:R,accept:"audio/mp3,audio/wav",class:"w-full"},null,32),a[9]||(a[9]=o("small",{class:"text-muted"},"Deja en blanco para mantener el audio actual",-1)),l.value.archivo?(c(),d("div",J,[a[5]||(a[5]=o("p",null,"Audio actual:",-1)),o("audio",K,[o("source",{src:l.value.archivo,type:"audio/mpeg"},null,8,Q),a[4]||(a[4]=b(" Tu navegador no soporta audio HTML5. "))])])):v("",!0),s.value.archivo?(c(),d("div",W,[a[7]||(a[7]=o("p",null,"Audio nuevo (vista previa):",-1)),o("audio",X,[o("source",{src:t.value,type:"audio/mpeg"},null,8,Y),a[6]||(a[6]=b(" Tu navegador no soporta audio HTML5. "))])])):v("",!0)]),o("div",Z,[m(_,{type:"button",label:"Cancelar",class:"p-button-text mr-2",onClick:a[1]||(a[1]=g=>e.$router.push("/admin/canciones"))}),m(_,{type:"submit",label:"Guardar cambios",loading:U(D)},null,8,["loading"])])],32)])])])])}}};export{ta as default};
