import{M as P,A as w,p as d,R as N,C as y,b,h as o,k as A,P as f,y as _,G as U,a2 as I,t as m,F as V,i as x,o as h,f as O}from"./app-BArZ-JoB.js";import{u as B,A as q}from"./funcionesArtista-Bm8O1XxS.js";import{_ as G}from"./_plugin-vue_export-helper-DlAUqK2U.js";const H={class:"layout"},z={class:"appPanel"},J={class:"contenidoUpload"},K={class:"maximo-contenido"},Q={class:"header_formulario"},W={class:"imagen_album"},X=["src"],Y={class:"informacion_album"},Z={class:"album_info"},ee={class:"lista_canciones"},ae={class:"numero_cancion"},oe=["onUpdate:modelValue"],ne={class:"duracion_cancion"},te=["onClick"],re={class:"acciones_canciones"},se={__name:"upload",setup(ie){const i=P();w().user;const p=d(null),v=d(null),c=d(null),s=d([]),{cargando:le,error:ce,subirAlbumCompleto:j}=B(),r=N({nombre:"",tipo:"Album",portada:null}),L=a=>new Promise(e=>{const n=new Audio,t=URL.createObjectURL(a);n.src=t,n.addEventListener("loadedmetadata",()=>{const l=Math.floor(n.duration),u=Math.floor(l/60),M=l%60;URL.revokeObjectURL(t),n.remove(),e(`${u}:${M.toString().padStart(2,"0")}`)}),n.addEventListener("error",()=>{URL.revokeObjectURL(t),n.remove(),e("0:00")})}),k=a=>{const e=a.target.files[0];e&&(c.value&&URL.revokeObjectURL(c.value),r.portada=e,c.value=URL.createObjectURL(e),i.add({severity:"info",summary:"Portada seleccionada",detail:"Imagen de portada añadida correctamente",life:3e3}))},C=async a=>{const e=Array.from(a.target.files);if(e.length!==0){for(const n of e){const t=await L(n);s.value.push({nombre:n.name.replace(/\.[^/.]+$/,""),file:n,duracion:t})}i.add({severity:"success",summary:"Canciones añadidas",detail:`${e.length} canción(es) agregadas`,life:3e3}),a.target.value=""}},S=()=>{r.nombre="",r.tipo="Album",r.portada=null,c.value=null,s.value=[],p.value&&(p.value.value=""),v.value&&(v.value.value="")},R=a=>{s.value.splice(a,1),i.add({severity:"success",summary:"Canción eliminada",detail:"La canción fue removida del álbum",life:3e3})},E=()=>s.value.reduce((a,e)=>{const[n,t]=e.duracion.split(":").map(Number);return a+n*60+t},0),$=a=>{const e=Math.floor(a/60),n=a%60;return`${e}:${n.toString().padStart(2,"0")}`},g=y(()=>$(E()));y(()=>r.nombre&&r.portada&&s.value.length>0&&s.value.every(a=>a.nombre));const T=()=>{let a=[];if(r.nombre||a.push({campo:"nombre",mensaje:"Falta añadir el nombre del álbum"}),r.portada||a.push({campo:"portada",mensaje:"Falta añadir la portada del álbum"}),s.value.length===0)a.push({campo:"canciones",mensaje:"Debe añadir al menos una canción"});else{const e=s.value.filter(n=>!n.nombre);e.length>0&&a.push({campo:"nombreCanciones",mensaje:`${e.length} canción(es) sin nombre`})}return a},D=async()=>{const a=T();if(a.length>0){i.removeGroup("validacion"),a.forEach(e=>{i.add({severity:"error",summary:"Error de validación",detail:e.mensaje,life:5e3,group:"validacion"})});return}F()},F=async()=>{try{await j({nombre:r.nombre,tipo:r.tipo,portada:r.portada,duracionTotal:g.value},s.value),i.add({severity:"success",summary:"Álbum creado",detail:"El álbum se ha creado exitosamente",life:5e3}),S()}catch(a){console.error("Error:",a),i.add({severity:"error",summary:"Error al guardar",detail:"Ha ocurrido un error al crear el álbum",life:5e3})}};return(a,e)=>{const n=O("Toast");return h(),b("section",H,[o("div",z,[A(q)]),o("section",J,[o("div",K,[e[5]||(e[5]=o("h1",{class:"titulo_subir_musica"},"Subir Música",-1)),o("form",{onSubmit:f(D,["prevent"]),class:"formulario_album"},[o("div",Q,[o("div",W,[o("img",{src:c.value||"/images/placeholder1.jpg",class:"estilo_imagen"},null,8,X),o("input",{type:"file",onChange:k,accept:"image/*",ref_key:"archivoImagen",ref:p,class:"añadir_archivo"},null,544)]),o("div",Y,[_(o("input",{"onUpdate:modelValue":e[0]||(e[0]=t=>r.nombre=t),placeholder:"Nombre álbum",class:"inputs_form",maxlength:"45"},null,512),[[U,r.nombre]]),_(o("select",{"onUpdate:modelValue":e[1]||(e[1]=t=>r.tipo=t),class:"select_form"},e[3]||(e[3]=[o("option",{value:"Album"},"Álbum",-1),o("option",{value:"Sencillo"},"Sencillo",-1),o("option",{value:"EP"},"EP",-1)]),512),[[I,r.tipo]]),o("div",Z,[o("p",null,"Número de canciones: "+m(s.value.length),1),o("p",null,"Duración total: "+m(g.value),1)])])]),o("section",ee,[(h(!0),b(V,null,x(s.value,(t,l)=>(h(),b("div",{key:l,class:"cancion"},[o("span",ae,m(l+1),1),_(o("input",{"onUpdate:modelValue":u=>t.nombre=u,placeholder:"Nombre de la canción",class:"input_cancion",maxlength:"45"},null,8,oe),[[U,t.nombre]]),o("span",ne,m(t.duracion||"0:00"),1),o("button",{onClick:f(u=>R(l),["prevent"]),class:"quitar_cancion"},"⨯",8,te)]))),128))]),o("div",re,[o("input",{type:"file",ref_key:"archivoAudio",ref:v,onChange:C,accept:"audio/*",class:"hidden",multiple:""},null,544),o("button",{onClick:e[2]||(e[2]=f(t=>a.$refs.archivoAudio.click(),["prevent"])),class:"cancion_boton"}," Añadir canción ")]),e[4]||(e[4]=o("button",{type:"submit",class:"boton_confirmar"}," Confirmar ",-1)),A(n,{group:"validacion"})],32)])])])}}},pe=G(se,[["__scopeId","data-v-e31f8d53"]]);export{pe as default};
