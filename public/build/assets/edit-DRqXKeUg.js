import{M as Ae,A as Se,p as b,D as we,b as m,h as o,k as u,v as l,t as f,F as D,i as R,x as k,o as p,P as F,n as O,e as $e,aa as q,L as W,O as I,Z as y,_ as B,Q as ke,I as xe}from"./app-BArZ-JoB.js";import{u as Ne,A as De}from"./funcionesArtista-Bm8O1XxS.js";import{s as Ie}from"./index-DBkJWd5m.js";import{_ as Te}from"./_plugin-vue_export-helper-DlAUqK2U.js";const je={class:"layout"},Me={class:"appPanel"},Ue={class:"contenido_edit"},Ve={key:0,class:"cargando"},Le={key:1,class:"error"},Pe={class:"color_texto"},ze={key:2,class:"sin_albums"},Re={key:3,class:"album_caja"},Fe={class:"album_portada"},Oe=["src"],qe={class:"informacion_album"},We={class:"nombre_album"},Be={class:"nombre_album_texto"},Je={class:"album-actions"},Ge=["onClick"],Ke=["onClick"],Qe={class:"detalle_album"},Xe={class:"tipo_album"},Ze={class:"album_Ncancion"},He={class:"duracion_album"},Ye={class:"row"},ea={class:"config_imagenes col-md-6"},aa=["src"],oa={key:0},ta={class:"col-md-6"},sa={class:"flex items-center gap-4 mb-4"},ra={class:"flex items-center gap-4 mb-4"},la={class:"resumen_album mt-4"},na={class:"resumen_caja"},ia={class:"resumen_caja"},da={key:0,class:"sin_canciones"},ua={key:1,class:"songs-list"},ca={class:"song-info"},ma={class:"song-number"},pa={class:"song-name-edit"},va={class:"song-duration"},ba={class:"song-actions"},fa={class:"añadir_Canciones_Seccion mt-4"},ga={class:"add-songs-controls"},_a={class:"flex justify-end gap-2 mt-4"},ya={class:"flex justify-end gap-2 mt-4"},ha={__name:"edit",setup(Ca){const J=xe(),c=Ae(),G=Se().user,{albums:T,cargando:K,error:x,getAlbumesUsuario:Q,getCancionesAlbum:X,eliminarAlbum:Z,eliminarCancion:H,agregarCancion:Y,actualizarPortadaAlbum:ee,actualizarAlbum:ae}=Ne(),h=b(!1),C=b(!1),i=b(null),S=b(null),w=b(null),d=b([]),E=b(!1),$=b(!1),_=b([]),N=b([]),oe=[{label:"Álbum",value:"album"},{label:"EP",value:"ep"},{label:"Sencillo",value:"sencillo"}],te=a=>{if(!a.nombre||a.nombre.trim()===""){c.add({severity:"error",summary:"Error",detail:"El nombre de la canción no puede estar vacío",life:3e3});const e=N.value.find(t=>t.id===a.id);e?a.nombre=e.nombre:a.nombre="Sin título";return}if(a.isNew){const e=_.value.find(t=>t.id===a.id);e&&(e.nombre=a.nombre);return}a.nombreModificado||(a.nombreModificado=!0)},se=a=>{a.preventDefault(),E.value=!0},re=()=>{E.value=!1},le=a=>{a.preventDefault(),E.value=!1;const e=a.dataTransfer.files;if(e.length>0&&e[0].type.startsWith("image/")){w.value=e[0];const t=new FileReader;t.onload=r=>{S.value=r.target.result},t.readAsDataURL(e[0])}},ne=a=>{a.preventDefault(),$.value=!0},ie=()=>{$.value=!1},de=a=>{a.preventDefault(),$.value=!1;const e=a.dataTransfer.files;if(e.length>0){const t=Array.from(e).filter(r=>r.type.startsWith("audio/")||r.name.endsWith(".mp3")||r.name.endsWith(".wav")||r.name.endsWith(".ogg")||r.name.endsWith(".flac"));t.length>0&&L(t)}},j=async()=>{await Q(G.id)};function M(a){let e=a.portada;return new URL(e,import.meta.url).href}const ue=async a=>{i.value={id:a.id,nombre:a.nombre||"",tipo:a.tipo||"album",num_canciones:a.num_canciones||0,duracion_total:a.duracion_total||"00:00",portada:a.portada},console.log("Album seleccionado para editar:",i.value),S.value=M(a),await ce(a.id),h.value=!0},ce=async a=>{try{d.value=await X(a),N.value=JSON.parse(JSON.stringify(d.value))}catch{d.value=[],c.add({severity:"error",summary:"Error",detail:"Error al cargar canciones del álbum",life:3e3})}},me=a=>{const e=a.target.files[0];if(e){w.value=e;const t=new FileReader;t.onload=r=>{S.value=r.target.result},t.readAsDataURL(e)}},U=a=>{if(!a)return"00:00";if(typeof a=="string"){const e=a.split("T");if(e.length>1){const r=e[1].split(".")[0],n=r.split(":");return n[0]==="00"?`${n[1]}:${n[2]}`:r}const t=a.split(":");return t.length===3&&t[0]==="00"?`${t[1]}:${t[2]}`:a}return"00:00"},pe=a=>a?U(a):"00:00",V=()=>{if(d.value.length===0)return"00:00:00";let a=0;d.value.forEach(n=>{if(n.duracion){const v=n.duracion.split(":");v.length===3?a+=parseInt(v[0])*3600+parseInt(v[1])*60+parseInt(v[2]):v.length===2&&(a+=parseInt(v[0])*60+parseInt(v[1]))}});const e=Math.floor(a/3600),t=Math.floor(a%3600/60),r=a%60;return`${e.toString().padStart(2,"0")}:${t.toString().padStart(2,"0")}:${r.toString().padStart(2,"0")}`},ve=()=>{const a=document.createElement("input");a.type="file",a.accept="audio/*",a.multiple=!0,a.onchange=e=>{L(e.target.files)},a.click()},L=a=>{Array.from(a).forEach(e=>{const t=new Audio;t.src=URL.createObjectURL(e),t.onloadedmetadata=()=>{const r=Math.floor(t.duration/60),n=Math.floor(t.duration%60),v=`${r.toString().padStart(2,"0")}:${n.toString().padStart(2,"0")}`,A={id:"new_"+Date.now()+"_"+Math.floor(Math.random()*1e3),nombre:e.name.replace(/\.[^/.]+$/,""),duracion:v,file:e,isNew:!0};_.value.push(A),d.value.push(A)}})},be=a=>{d.value=d.value.filter(e=>e.id!==a.id),a.isNew&&(_.value=_.value.filter(e=>e.id!==a.id)),c.add({severity:"info",summary:"Canción eliminada",detail:"La canción ha sido eliminada del álbum",life:3e3})},fe=a=>{i.value=a,C.value=!0},ge=async()=>{if(i.value)try{await Z(i.value.id)?(C.value=!1,c.add({severity:"success",summary:"Éxito",detail:"Álbum eliminado correctamente",life:3e3})):c.add({severity:"error",summary:"Error",detail:"Error al eliminar el álbum",life:3e3})}catch(a){console.error("Error al eliminar el álbum:",a),c.add({severity:"error",summary:"Error",detail:"Error al eliminar el álbum",life:3e3})}},_e=async()=>{var a,e,t,r;try{if(!((a=i.value.nombre)!=null&&a.trim())){c.add({severity:"error",summary:"Error",detail:"Nombre requerido",life:3e3});return}const n=d.value.filter(s=>!s.isNew).map(s=>s.id),v=N.value.filter(s=>!n.includes(s.id));for(const s of v)try{await H(s.id),console.log(`Canción ${s.nombre} eliminada correctamente`)}catch(g){console.error(`Error al eliminar canción ${s.nombre}:`,g),c.add({severity:"error",summary:"Error",detail:`Error al eliminar canción: ${s.nombre}`,life:3e3})}const P=d.value.filter(s=>!s.isNew&&s.nombreModificado);for(const s of P)try{if(!(await fetch(`/api/canciones/${s.id}`,{method:"PUT",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content"),Accept:"application/json"},body:JSON.stringify({nombre:s.nombre,duracion:s.duracion})})).ok)throw new Error(`Error al actualizar el nombre de la canción: ${s.nombre}`);console.log(`Nombre de canción actualizado: ${s.nombre}`)}catch(g){console.error(`Error al actualizar el nombre de la canción ${s.nombre}:`,g),c.add({severity:"error",summary:"Error",detail:`Error al actualizar el nombre: ${s.nombre}`,life:3e3})}const A=[];for(const s of _.value)try{const g=await Y(s,i.value.id,d.value.findIndex(Ee=>Ee.id===s.id)+1);g&&A.push(g.id)}catch{c.add({severity:"error",summary:"Error",detail:`Error al guardar canción: ${s.nombre}`,life:3e3})}let z=null;w.value&&(z=await ee(i.value.id,w.value),z||c.add({severity:"error",summary:"Error",detail:"Error al subir la portada",life:3e3}));const he=[...d.value.filter(s=>!s.isNew).map(s=>s.id),...A],Ce={nombre:i.value.nombre,tipo:i.value.tipo||"album",num_canciones:d.value.length,duracion_total:V(),canciones:JSON.stringify(he)};await ae(i.value.id,Ce)?(await j(),_.value=[],h.value=!1,c.add({severity:"success",summary:"Éxito",detail:"Álbum actualizado",life:3e3})):c.add({severity:"error",summary:"Error",detail:x.value||"Error al actualizar el álbum",life:3e3})}catch(n){console.error("Error:",(e=n.response)==null?void 0:e.data),c.add({severity:"error",summary:"Error",detail:((r=(t=n.response)==null?void 0:t.data)==null?void 0:r.message)||"Error al guardar",life:3e3})}},ye=()=>{J.push({name:"artista.upload"})};return we(()=>{j()}),(a,e)=>(p(),m(D,null,[e[24]||(e[24]=o("div",{class:"show"},null,-1)),e[25]||(e[25]=o("div",{class:"show2"},null,-1)),o("section",je,[o("div",Me,[u(De)]),o("section",Ue,[e[22]||(e[22]=o("h1",{class:"titulo_albums"},"Tus Álbums",-1)),e[23]||(e[23]=o("h2",{class:"color_texto"},"Selecciona álbum:",-1)),l(K)?(p(),m("div",Ve,e[6]||(e[6]=[o("p",{class:"color_texto"},"Cargando álbumes...",-1)]))):l(x)?(p(),m("div",Le,[o("p",Pe,f(l(x)),1)])):l(T).length===0?(p(),m("div",ze,[e[7]||(e[7]=o("p",{class:"color_texto"},"No tienes álbumes creados aún.",-1)),o("button",{class:"crear_album_boton",onClick:ye},"Crear nuevo álbum")])):(p(),m("div",Re,[(p(!0),m(D,null,R(l(T),t=>(p(),m("div",{key:t.id,class:"albums_items"},[o("div",Fe,[o("img",{src:M(t),alt:"Portada del álbum"},null,8,Oe)]),o("div",qe,[o("div",We,[o("p",Be,f(t.nombre),1),o("div",Je,[o("button",{class:"boton_editar",onClick:F(r=>ue(t),["stop"])},e[8]||(e[8]=[o("i",{class:"pi pi-pencil"},null,-1)]),8,Ge),o("button",{class:"boton_borrar",onClick:F(r=>fe(t),["stop"])},e[9]||(e[9]=[o("i",{class:"pi pi-trash"},null,-1)]),8,Ke)])]),o("div",Qe,[o("p",Xe,f(t.tipo),1),o("p",Ze,f(t.num_canciones)+" canciones",1),o("p",He,f(pe(t.duracion_total)),1)])])]))),128))])),u(l(B),{class:"dialog_estilo",visible:h.value,"onUpdate:visible":e[3]||(e[3]=t=>h.value=t),modal:"",header:"Editar Álbum",appendTo:".show"},{default:k(()=>[o("div",Ye,[o("div",ea,[o("div",{class:O(["imagen_config_perfil",{"drag-over":E.value}]),onDragover:se,onDragleave:re,onDrop:le},[o("img",{src:S.value||"/images/placeholder.jpg",class:"estilo_imagen"},null,8,aa),E.value?(p(),m("div",oa,e[10]||(e[10]=[o("p",null,"Suelta para cambiar la imagen",-1)]))):$e("",!0),o("input",{type:"file",onChange:me,accept:"image/jpeg,image/png,image/jpg,image/gif",class:"añadir_archivo"},null,32)],34),e[11]||(e[11]=o("p",{class:"text-sm text-center"},"Arrastra una imagen para cambiar la portada del álbum",-1))]),o("div",ta,[o("div",sa,[u(l(q),{variant:"on"},{default:k(()=>[u(l(W),{class:"dialog_input",id:"albumNombre",modelValue:i.value.nombre,"onUpdate:modelValue":e[0]||(e[0]=t=>i.value.nombre=t),maxlength:"45"},null,8,["modelValue"]),e[12]||(e[12]=o("label",{for:"albumNombre"},"Nombre del álbum",-1))]),_:1})]),o("div",ra,[u(l(q),{variant:"on"},{default:k(()=>[u(l(Ie),{class:"dialog_input",id:"albumTipo",modelValue:i.value.tipo,"onUpdate:modelValue":e[1]||(e[1]=t=>i.value.tipo=t),options:oe,optionLabel:"label",optionValue:"value",style:{color:"white"}},null,8,["modelValue"]),e[13]||(e[13]=o("label",{for:"albumTipo"},"Tipo",-1))]),_:1})]),o("div",la,[o("div",na,[e[14]||(e[14]=o("div",{class:"resumen_label"},[o("i",{class:"pi pi-list"}),I(" Canciones:")],-1)),o("div",null,f(d.value.length),1)]),o("div",ia,[e[15]||(e[15]=o("div",null,[o("i",{class:"pi pi-clock"}),I(" Duración total:")],-1)),o("div",null,f(V()),1)])])])]),o("div",{class:O(["album-songs-section mt-6",{"drag-over":$.value}]),onDragover:ne,onDragleave:ie,onDrop:de},[e[20]||(e[20]=o("h3",{class:"songs-title"},"Canciones del álbum",-1)),d.value.length===0?(p(),m("div",da,e[16]||(e[16]=[o("p",null,"Este álbum no tiene canciones.",-1),o("p",{class:"text-sm mt-2"},"Arrastra archivos de audio aquí para añadirlos al álbum",-1)]))):(p(),m("div",ua,[(p(!0),m(D,null,R(d.value,(t,r)=>(p(),m("div",{key:r,class:"song-item"},[o("div",ca,[o("p",ma,f(r+1),1),o("div",pa,[u(l(W),{modelValue:t.nombre,"onUpdate:modelValue":n=>t.nombre=n,class:"song-name-input",onBlur:n=>te(t),placeholder:"Nombre de la canción"},null,8,["modelValue","onUpdate:modelValue","onBlur"])]),o("p",va,[e[17]||(e[17]=o("i",{class:"pi pi-clock"},null,-1)),I(" "+f(U(t.duracion)),1)])]),o("div",ba,[u(l(y),{icon:"pi pi-trash",class:"p-button-rounded boton_eliminar",onClick:n=>be(t)},null,8,["onClick"])])]))),128))])),o("div",fa,[e[19]||(e[19]=o("h4",null,"Añadir canciones",-1)),o("div",ga,[e[18]||(e[18]=o("div",{class:"flex items-center gap-4 mb-4"},[o("p",{class:"text-sm"},"arrastra archivos de audio aquí")],-1)),u(l(y),{label:"Añadir canción",icon:"pi pi-plus",onClick:ve})])])],34),o("div",_a,[u(l(y),{type:"button",label:"Cancelar",class:"boton_cancelar",onClick:e[2]||(e[2]=t=>h.value=!1)}),u(l(y),{type:"button",label:"Guardar",onClick:_e})])]),_:1},8,["visible"]),u(l(B),{visible:C.value,"onUpdate:visible":e[5]||(e[5]=t=>C.value=t),modal:"",header:"Confirmar eliminación",class:"dialog_estilo",appendTo:".show2"},{default:k(()=>{var t;return[o("p",null,'¿Estás seguro de que quieres eliminar el álbum "'+f((t=i.value)==null?void 0:t.nombre)+'"?',1),e[21]||(e[21]=o("p",{class:"text-red-500"},"Esta acción no se puede deshacer.",-1)),o("div",ya,[u(l(y),{type:"button",label:"Cancelar",class:"boton_cancelar",onClick:e[4]||(e[4]=r=>C.value=!1)}),u(l(y),{type:"button",label:"Eliminar",class:"boton_eliminar",onClick:ge})])]}),_:1},8,["visible"]),u(l(ke))])])],64))}},ka=Te(ha,[["__scopeId","data-v-d3fc5333"]]);export{ka as default};
