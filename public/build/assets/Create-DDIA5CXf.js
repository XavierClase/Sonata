import{M as A,p,R as E,C as y,b,h as a,P as v,y as g,G as C,a2 as I,t as f,e as T,F as V,i as M,k as O,v as P,o as h,Q as q,I as B}from"./app-BArZ-JoB.js";import{u as G}from"./albumesAdmin-wFGr6eia.js";const H={class:""},Q={class:""},z={class:"row mb-4"},J={class:"col-12 text-center mb-6"},K={class:"imagen_album",style:{width:"200px",height:"200px"}},W=["src"],X={class:"col-md-6"},Y={class:"form-group mb-3"},Z={class:"col-md-6"},ee={class:"form-group mb-3"},ae={class:"col-12"},oe={class:"album_info mt-2"},te={class:"row mb-3"},ne={class:"col-12"},se={class:"lista_canciones"},re={key:0,class:"text-center py-3 text-muted"},ie={class:"numero_cancion me-2"},le=["onUpdate:modelValue"],ce={class:"duracion_cancion me-2"},de=["onClick"],ue={class:"row mb-4"},me={class:"col-12"},pe={class:"d-flex justify-content-between"},be=["disabled"],ge={__name:"Create",setup(ve){const l=A(),j=B();G();const k=p(null),w=p(null),m=p(null),n=p([]),s=E({nombre:"",tipo:"album",portada:null}),R=t=>new Promise(e=>{const o=new Audio,r=URL.createObjectURL(t);o.src=r,o.addEventListener("loadedmetadata",()=>{const i=Math.floor(o.duration),c=Math.floor(i/60),u=i%60;URL.revokeObjectURL(r),o.remove(),e(`${c}:${u.toString().padStart(2,"0")}`)}),o.addEventListener("error",()=>{URL.revokeObjectURL(r),o.remove(),e("0:00")})}),U=t=>{const e=t.target.files[0];e&&(m.value&&URL.revokeObjectURL(m.value),s.portada=e,m.value=URL.createObjectURL(e),l.add({severity:"info",summary:"Portada seleccionada",detail:"Imagen de portada añadida correctamente",life:3e3}))},L=async t=>{const e=Array.from(t.target.files);if(e.length!==0){for(const o of e){const r=await R(o);n.value.push({nombre:o.name.replace(/\.[^/.]+$/,""),archivo:o,duracion:r})}l.add({severity:"success",summary:"Canciones añadidas",detail:`${e.length} canción(es) agregadas`,life:3e3}),t.target.value=""}},$=t=>{n.value.splice(t,1),l.add({severity:"success",summary:"Canción eliminada",detail:"La canción fue removida del álbum",life:3e3})},S=()=>n.value.reduce((t,e)=>{const[o,r]=e.duracion.split(":").map(Number);return t+o*60+r},0),D=t=>{const e=Math.floor(t/60),o=t%60;return`${e}:${o.toString().padStart(2,"0")}`},_=y(()=>D(S())),x=y(()=>s.nombre&&s.portada&&n.value.length>0&&n.value.every(t=>t.nombre)),F=()=>{let t=[];if(s.nombre||t.push({campo:"nombre",mensaje:"Falta añadir el nombre del álbum"}),s.portada||t.push({campo:"portada",mensaje:"Falta añadir la portada del álbum"}),n.value.length===0)t.push({campo:"canciones",mensaje:"Debe añadir al menos una canción"});else{const e=n.value.filter(o=>!o.nombre);e.length>0&&t.push({campo:"nombreCanciones",mensaje:`${e.length} canción(es) sin nombre`})}return t},N=async()=>{var e;const t=F();if(t.length>0){t.forEach(o=>{l.add({severity:"error",summary:"Error de validación",detail:o.mensaje,life:3e3})});return}try{const o=new FormData;o.append("nombre",s.nombre),o.append("tipo",s.tipo),o.append("portada",s.portada),o.append("num_canciones",n.value.length.toString()),o.append("duracion_total",_.value);const i=(await axios.post("/api/admin/albumes",o,{headers:{"Content-Type":"multipart/form-data"}})).data.album.id;for(let c=0;c<n.value.length;c++){const u=n.value[c],d=new FormData;d.append("nombre",u.nombre),d.append("duracion",u.duracion),d.append("archivo",u.archivo),d.append("album_id",i),d.append("orden",(c+1).toString()),await axios.post("/api/canciones",d,{headers:{"Content-Type":"multipart/form-data"}})}l.add({severity:"success",summary:"Álbum creado",detail:"El álbum se ha creado exitosamente",life:3e3}),j.push("/admin/albumes")}catch(o){console.error("Error:",(e=o.response)==null?void 0:e.data),l.add({severity:"error",summary:"Error al guardar",detail:"Ha ocurrido un error al crear el álbum",life:3e3})}};return(t,e)=>(h(),b("div",H,[e[9]||(e[9]=a("div",{class:""},[a("h2",{class:""},"Crear Nuevo Álbum")],-1)),a("div",Q,[a("form",{onSubmit:v(N,["prevent"]),class:"formulario_album"},[a("div",z,[a("div",J,[a("div",K,[a("img",{src:m.value||"/images/placeholder1.jpg",class:"",style:{width:"100%",height:"100%","object-fit":"cover"}},null,8,W),a("input",{type:"file",onChange:U,accept:"image/*",ref_key:"archivoImagen",ref:k,class:"d-none"},null,544),a("button",{onClick:e[0]||(e[0]=v(o=>t.$refs.archivoImagen.click(),["prevent"])),class:"btn btn-outline-primary mt-2"}," Seleccionar Portada ")])]),a("div",X,[a("div",Y,[e[5]||(e[5]=a("label",{for:"nombre"},"Nombre del álbum*",-1)),g(a("input",{type:"text",id:"nombre","onUpdate:modelValue":e[1]||(e[1]=o=>s.nombre=o),class:"form-control",placeholder:"Nombre del álbum",maxlength:"45",required:""},null,512),[[C,s.nombre]])])]),a("div",Z,[a("div",ee,[e[7]||(e[7]=a("label",{for:"tipo"},"Tipo*",-1)),g(a("select",{id:"tipo","onUpdate:modelValue":e[2]||(e[2]=o=>s.tipo=o),class:"form-select",required:""},e[6]||(e[6]=[a("option",{value:"album"},"Álbum",-1),a("option",{value:"sencillo"},"Sencillo",-1),a("option",{value:"ep"},"EP",-1)]),512),[[I,s.tipo]])])]),a("div",ae,[a("div",oe,[a("p",null,"Número de canciones: "+f(n.value.length),1),a("p",null,"Duración total: "+f(_.value),1)])])]),a("div",te,[a("div",ne,[e[8]||(e[8]=a("h4",null,"Canciones",-1)),a("div",se,[n.value.length===0?(h(),b("div",re," No hay canciones añadidas ")):T("",!0),(h(!0),b(V,null,M(n.value,(o,r)=>(h(),b("div",{key:r,class:"cancion border-bottom py-2 d-flex align-items-center"},[a("span",ie,f(r+1),1),g(a("input",{"onUpdate:modelValue":i=>o.nombre=i,placeholder:"Nombre de la canción",class:"form-control me-2",maxlength:"45"},null,8,le),[[C,o.nombre]]),a("span",ce,f(o.duracion||"0:00"),1),a("button",{onClick:v(i=>$(r),["prevent"]),class:"btn btn-sm btn-danger"},"⨯",8,de)]))),128))])])]),a("div",ue,[a("div",me,[a("input",{type:"file",ref_key:"archivoAudio",ref:w,onChange:L,accept:"audio/*",class:"d-none",multiple:""},null,544),a("button",{onClick:e[3]||(e[3]=v(o=>t.$refs.archivoAudio.click(),["prevent"])),class:"btn btn-primary"}," Añadir canción ")])]),a("div",pe,[a("button",{type:"button",class:"btn btn-secondary",onClick:e[4]||(e[4]=o=>t.$router.push("/admin/albumes"))}," Cancelar "),a("button",{type:"submit",class:"btn btn-success",disabled:!x.value}," Guardar Álbum ",8,be)]),O(P(q))],32)])]))}};export{ge as default};
