import{M as ae,p as m,D as oe,b as r,h as e,k as t,v as L,P as se,n as te,t as p,e as k,x as f,d as ie,F as le,f as v,o as l,y as re,O as z,I as ne,l as de,ae as ce}from"./app-BArZ-JoB.js";import{u as ue}from"./listasAdmin-DBsvEFmU.js";import{u as me}from"./cancionesAdmin-DfvjdQrT.js";import{s as pe}from"./index-DBkJWd5m.js";const ve={class:"grid"},fe={class:"col-12"},ye={class:"card"},be={class:"card-header mb-3"},_e={class:"flex justify-content-between align-items-center"},ge={key:0,class:"flex justify-content-center p-5"},he={class:"grid"},xe={class:"col-12 md:col-8"},we={class:"grid"},Ce={class:"col-12"},ke={class:"field"},Ee={key:0,class:"p-error"},De={class:"col-12"},Ve={class:"field"},Le={key:0,class:"p-error"},ze={class:"col-12 md:col-4"},Ne={class:"field"},Te={class:"flex flex-column align-items-center"},Be={class:"surface-card border-1 border-round border-300 p-0 mb-3",style:{height:"200px",width:"200px",overflow:"hidden"}},Se=["src"],je={key:1,class:"w-full h-full flex align-items-center justify-content-center bg-gray-100"},$e={key:0,class:"p-error mt-2"},Ae={class:"col-12 my-3"},Fe={class:"card p-3 border-1 border-300"},Ie={class:"grid"},Pe={class:"col-12 md:col-8"},Re={class:"flex align-items-center"},Ue=["src","alt"],Me={key:1,class:"pi pi-image text-gray-400 mr-2",style:{"font-size":"1.25rem"}},qe={class:"font-medium"},Ge={class:"text-sm text-gray-500"},He={class:"col-12 md:col-4"},Oe={class:"col-12 mt-4"},Ye={class:"card p-0"},Je={class:"flex justify-content-between align-items-center p-3 bg-gray-50 border-round-top"},Ke={class:"font-medium text-500"},Qe={class:"flex align-items-center justify-content-center"},We=["src"],Xe={key:1,class:"pi pi-image text-gray-400",style:{"font-size":"1.5rem"}},Ze={class:"font-medium"},ea={key:1,class:"p-5 text-center text-gray-500 border-1 border-gray-200 border-round-bottom"},aa={class:"col-12 flex justify-content-end mt-4"},oa={class:"flex align-items-center"},ca={__name:"Edit",setup(sa){const E=ne(),y=de(),n=ae(),{getLista:N,updateLista:T,updatePortada:B,getCancionesLista:S,eliminarCancionDeLista:j,añadirCancionALista:$,errors:A,loading:F}=ue(),c=m({}),w=m(null),_=m([]),g=m(!1),h=m(!1),d=m(null),{canciones:I,getCanciones:P,loading:ta}=me(),D=m([]),x=m(!1),i=m({nombre:"",descripcion:"",portada:null,nuevaPortada:null}),V=()=>{const o=_.value.map(a=>a.id);D.value=I.value.data.filter(a=>!o.includes(a.id))},R=async()=>{if(d.value){x.value=!0;try{await $(y.params.id,d.value.id),n.add({severity:"success",summary:"Éxito",detail:`"${d.value.nombre}" se ha añadido a la lista`,life:3e3}),d.value=null,await C(),V()}catch(o){console.error("Error al añadir canción:",o),n.add({severity:"error",summary:"Error",detail:"No se pudo añadir la canción a la lista",life:3e3})}finally{x.value=!1}}},U=async()=>{try{await P(),V()}catch(o){console.error("Error al cargar canciones:",o),n.add({severity:"error",summary:"Error",detail:"No se pudieron cargar las canciones disponibles",life:3e3})}},M=async()=>{try{const o=await N(y.params.id);i.value.nombre=o.nombre,i.value.descripcion=o.descripcion||"",i.value.portada=o.portada,await C()}catch(o){console.error("Error al cargar los datos:",o),n.add({severity:"error",summary:"Error",detail:"No se pudo cargar la información de la lista",life:3e3})}},C=async()=>{try{const o=await S(y.params.id);_.value=o}catch(o){console.error("Error al cargar las canciones:",o),n.add({severity:"error",summary:"Error",detail:"No se pudieron cargar las canciones de la lista",life:3e3})}},q=o=>{i.value.nuevaPortada=o.files[0];const a=new FileReader;a.onload=u=>{w.value=u.target.result},a.readAsDataURL(o.files[0]),o.files=[]},G=o=>{o.type==="max-file-size"&&(c.value.portada=["El archivo excede el tamaño máximo permitido (2MB)"],n.add({severity:"error",summary:"Error",detail:"El archivo excede el tamaño máximo permitido (2MB)",life:3e3}))},H=o=>{d.value=o,h.value=!0},O=async()=>{try{h.value=!1,await j(y.params.id,d.value.id),n.add({severity:"success",summary:"Éxito",detail:`"${d.value.titulo}" ha sido eliminada de la lista`,life:3e3}),await C()}catch(o){console.error("Error al eliminar la canción:",o),n.add({severity:"error",summary:"Error",detail:"No se pudo eliminar la canción de la lista",life:3e3})}},Y=async()=>{try{if(g.value=!0,c.value={},await T(y.params.id,{nombre:i.value.nombre,descripcion:i.value.descripcion}),i.value.nuevaPortada)try{await B(y.params.id,i.value.nuevaPortada)}catch(o){console.error("Error al actualizar la imagen:",o),n.add({severity:"warning",summary:"Advertencia",detail:"Los datos se actualizaron pero hubo un problema con la imagen",life:5e3}),g.value=!1,E.push("/admin/listas");return}n.add({severity:"success",summary:"Éxito",detail:"Lista de reproducción actualizada correctamente",life:3e3}),g.value=!1,E.push("/admin/listas")}catch(o){console.error("Error al actualizar la lista:",o),c.value=A.value||{},g.value=!1,n.add({severity:"error",summary:"Error",detail:"No se pudo actualizar la lista de reproducción",life:3e3})}};return oe(()=>{M(),U()}),(o,a)=>{const u=v("Button"),J=v("ProgressSpinner"),K=v("InputText"),Q=v("Textarea"),W=v("FileUpload"),b=v("Column"),X=v("DataTable"),Z=v("Dialog"),ee=ce("tooltip");return l(),r(le,null,[a[18]||(a[18]=e("div",{class:"show"},null,-1)),e("div",ve,[e("div",fe,[e("div",ye,[e("div",be,[e("div",_e,[a[7]||(a[7]=e("h5",{class:"m-0 text-xl font-medium"},"Editar Lista de Reproducción",-1)),t(u,{icon:"pi pi-arrow-left",label:"Volver",class:"p-button-outlined",onClick:a[0]||(a[0]=s=>o.$router.push("/admin/listas"))})])]),L(F)?(l(),r("div",ge,[t(J)])):(l(),r("form",{key:1,onSubmit:se(Y,["prevent"]),class:"p-fluid"},[e("div",he,[e("div",xe,[e("div",we,[e("div",Ce,[e("div",ke,[a[8]||(a[8]=e("label",{for:"nombre",class:"font-medium"},"Nombre de la lista",-1)),t(K,{id:"nombre",modelValue:i.value.nombre,"onUpdate:modelValue":a[1]||(a[1]=s=>i.value.nombre=s),class:te({"p-invalid":c.value.nombre}),placeholder:"Introduce un nombre para la lista"},null,8,["modelValue","class"]),c.value.nombre?(l(),r("small",Ee,p(c.value.nombre[0]),1)):k("",!0)])]),e("div",De,[e("div",Ve,[a[9]||(a[9]=e("label",{for:"descripcion",class:"font-medium"},"Descripción",-1)),t(Q,{id:"descripcion",modelValue:i.value.descripcion,"onUpdate:modelValue":a[2]||(a[2]=s=>i.value.descripcion=s),rows:"4",placeholder:"Describe brevemente esta lista de reproducción"},null,8,["modelValue"]),c.value.descripcion?(l(),r("small",Le,p(c.value.descripcion[0]),1)):k("",!0)])])])]),e("div",ze,[e("div",Ne,[a[11]||(a[11]=e("label",{for:"portada",class:"font-medium mb-2 block"},"Portada",-1)),e("div",Te,[e("div",Be,[w.value||i.value.portada?(l(),r("img",{key:0,src:w.value||i.value.portada,alt:"Vista previa",class:"w-full h-full object-cover"},null,8,Se)):(l(),r("div",je,a[10]||(a[10]=[e("i",{class:"pi pi-image text-4xl text-gray-400"},null,-1)])))]),t(W,{mode:"basic",name:"portada",accept:"image/*",maxFileSize:2e6,onSelect:q,onError:G,auto:!1,chooseLabel:"Cambiar imagen",class:"w-full"}),c.value.portada?(l(),r("small",$e,p(c.value.portada[0]),1)):k("",!0)])])]),e("div",Ae,[e("div",Fe,[a[12]||(a[12]=e("h6",{class:"mb-3"},"Añadir canciones a la lista",-1)),e("div",Ie,[e("div",Pe,[t(L(pe),{modelValue:d.value,"onUpdate:modelValue":a[3]||(a[3]=s=>d.value=s),options:D.value,optionLabel:"nombre",placeholder:"Buscar canción...",class:"w-full",filter:"",filterPlaceholder:"Buscar por nombre..."},{option:f(s=>[e("div",Re,[s.option.portada?(l(),r("img",{key:0,src:s.option.portada,alt:s.option.nombre,class:"mr-2",style:{width:"32px",height:"32px","object-fit":"cover","border-radius":"4px"}},null,8,Ue)):(l(),r("span",Me)),e("div",null,[e("span",qe,p(s.option.nombre),1),e("div",Ge,p(s.option.duracion),1)])])]),_:1},8,["modelValue","options"])]),e("div",He,[t(u,{label:"Añadir a la lista",icon:"pi pi-plus",class:"w-full",onClick:R,disabled:!d.value||x.value,loading:x.value},null,8,["disabled","loading"])])])])]),e("div",Oe,[e("div",Ye,[e("div",Je,[a[13]||(a[13]=e("h6",{class:"m-0 font-medium"},"Canciones en la Lista",-1)),e("div",null,[e("span",Ke,"Total: "+p(_.value.length)+" canciones",1)])]),_.value.length>0?(l(),ie(X,{key:0,value:_.value,stripedRows:"",rowHover:!0,responsiveLayout:"scroll"},{default:f(()=>[t(b,{field:"id",header:"ID",style:{width:"5rem"}}),t(b,{header:"Portada",style:{width:"6rem"}},{body:f(s=>[e("div",Qe,[s.data.portada?(l(),r("img",{key:0,src:s.data.portada,alt:"Portada",style:{height:"40px",width:"40px","object-fit":"cover","border-radius":"4px"}},null,8,We)):(l(),r("span",Xe))])]),_:1}),t(b,{field:"nombre",header:"Título"}),t(b,{field:"autor",header:"Artista"}),t(b,{field:"duracion",header:"Duración",style:{width:"8rem"}},{body:f(s=>[e("span",Ze,p(s.data.duracion),1)]),_:1}),t(b,{style:{width:"5rem"}},{body:f(s=>[re(t(u,{icon:"pi pi-trash",severity:"danger",size:"small",onClick:ia=>H(s.data),text:"",rounded:""},null,8,["onClick"]),[[ee,"Eliminar de la lista",void 0,{top:!0}]])]),_:1})]),_:1},8,["value"])):(l(),r("div",ea,a[14]||(a[14]=[e("i",{class:"pi pi-music text-4xl text-gray-300 mb-3"},null,-1),e("p",null,"No hay canciones en esta lista de reproducción.",-1)])))])]),e("div",aa,[t(u,{type:"button",label:"Cancelar",class:"p-button-outlined mr-2",onClick:a[4]||(a[4]=s=>o.$router.push("/admin/listas"))}),t(u,{type:"submit",label:"Guardar Cambios",icon:"pi pi-save",loading:g.value},null,8,["loading"])])])],32))])])]),t(Z,{visible:h.value,"onUpdate:visible":a[6]||(a[6]=s=>h.value=s),header:"Confirmar eliminación",style:{width:"450px"},modal:!0,appendTo:".show"},{footer:f(()=>[t(u,{label:"No",icon:"pi pi-times",class:"p-button-text",onClick:a[5]||(a[5]=s=>h.value=!1)}),t(u,{label:"Sí",icon:"pi pi-check",severity:"danger",onClick:O})]),default:f(()=>{var s;return[e("div",oa,[a[17]||(a[17]=e("i",{class:"pi pi-exclamation-triangle mr-3",style:{"font-size":"2rem",color:"var(--yellow-500)"}},null,-1)),e("span",null,[a[15]||(a[15]=z("¿Estás seguro de que quieres eliminar ")),e("strong",null,p((s=d.value)==null?void 0:s.titulo),1),a[16]||(a[16]=z(" de esta lista?"))])])]}),_:1},8,["visible"])],64)}}};export{ca as default};
