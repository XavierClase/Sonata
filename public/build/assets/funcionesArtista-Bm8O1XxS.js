import{u as k,A as F,p as d,C as P,f as $,o as i,b as p,h,F as w,i as N,k as R,x as S,O as V,t as z,e as E,H as o}from"./app-BArZ-JoB.js";import{_ as B}from"./_plugin-vue_export-helper-DlAUqK2U.js";const H={class:"texto_panel"},M={key:0,class:"texto_panel"},T={key:1,class:"menu-separator"},O={__name:"AppPanel",setup(m){const{can:t}=k();F();const n=d([{items:[{label:"Estadísticas",to:"/app/artista/estadisticas",permission:"album-create"},{label:"Subir Música",to:"/app/artista/upload",permission:"album-create"},{label:"Modificar Música",to:"/app/artista/edit",permission:"album-edit"}]}]),s=P(()=>n.value[0].items.filter(u=>u.separator||u.permission&&t(u.permission)));return(u,v)=>{const b=$("router-link");return i(),p("section",null,[v[0]||(v[0]=h("h1",{class:"h1_panel"},"Panel Artista",-1)),h("ul",H,[(i(!0),p(w,null,N(s.value,(c,y)=>(i(),p(w,{key:y},[c.separator?E("",!0):(i(),p("li",M,[R(b,{to:c.to,class:"texto_panel"},{default:S(()=>[V(z(c.label),1)]),_:2},1032,["to"])])),c.separator?(i(),p("li",T)):E("",!0)],64))),128))])])}}},j=B(O,[["__scopeId","data-v-a25ae88c"]]);function q(){const m=d([]),t=d(!1),n=d(null),s=d([]),u=async a=>{if(!a)return[];t.value=!0,n.value=null;try{const e=await o.get(`/api/canciones/usuario/${a}`);return m.value=e.data,m.value}catch(e){return console.error("Error al cargar las canciones del usuario:",e),n.value="No se pudieron cargar las canciones. Por favor, inténtalo de nuevo más tarde.",[]}finally{t.value=!1}},v=async a=>[...await u(a)].sort((l,r)=>r.reproducciones-l.reproducciones),b=async a=>{if(!a)return[];t.value=!0,n.value=null;try{const e=await o.get(`/api/albumes/${a}`);return s.value=e.data.data,s.value}catch(e){return console.error("Error al cargar álbumes:",e),n.value="Error al cargar los álbumes. Por favor, intenta de nuevo más tarde.",[]}finally{t.value=!1}},c=async a=>{if(!a)return[];t.value=!0,n.value=null;try{const e=await o.get(`/api/albumes/${a}/canciones`);return Array.isArray(e.data.data)?e.data.data:[]}catch(e){return console.error("Error al cargar canciones del álbum:",e),n.value="Error al cargar canciones del álbum",[]}finally{t.value=!1}},y=async a=>{if(!a)return!1;t.value=!0,n.value=null;try{return await o.delete(`/api/albumes/${a}`),s.value=s.value.filter(e=>e.id!==a),!0}catch(e){return console.error("Error al eliminar el álbum:",e),n.value="Error al eliminar el álbum",!1}finally{t.value=!1}},A=async a=>{if(!a)return!1;t.value=!0,n.value=null;try{return await o.delete(`/api/canciones/${a}`),!0}catch(e){return console.error("Error al eliminar la canción:",e),n.value="Error al eliminar la canción",!1}finally{t.value=!1}},_=async(a,e,l)=>{if(!a||!e)return null;t.value=!0,n.value=null;try{const r=new FormData;return r.append("archivo",a.file),r.append("album_id",e),r.append("nombre",a.nombre),r.append("duracion",a.duracion),r.append("orden",l),(await o.post("/api/canciones",r)).data.cancion}catch(r){return console.error("Error al guardar canción:",r),n.value=`Error al guardar canción: ${a.nombre}`,null}finally{t.value=!1}},C=async(a,e)=>{if(!a||!e)return null;t.value=!0,n.value=null;try{const l=new FormData;return l.append("portada",e),l.append("album_id",a),(await o.post(`/api/albumes/${a}/portada`,l)).data.portada_url}catch(l){return console.error("Error al subir la portada:",l),n.value="Error al subir la portada",null}finally{t.value=!1}},x=async(a,e)=>{var l,r;if(!a)return!1;t.value=!0,n.value=null;try{return await o.put(`/api/albumes/${a}`,e),!0}catch(f){return console.error("Error al actualizar álbum:",f),n.value=((r=(l=f.response)==null?void 0:l.data)==null?void 0:r.message)||"Error al guardar",!1}finally{t.value=!1}},g=async(a,e)=>{var l;t.value=!0,n.value=null;try{const r=new FormData;return r.append("nombre",a.nombre),r.append("tipo",a.tipo),r.append("portada",e),r.append("num_canciones",a.num_canciones),r.append("duracion_total",a.duracion_total),(await o.post("/api/albums",r,{headers:{"Content-Type":"multipart/form-data"}})).data.album}catch(r){throw console.error("Error al crear el álbum:",(l=r.response)==null?void 0:l.data),n.value="Ha ocurrido un error al crear el álbum",r}finally{t.value=!1}};return{canciones:m,albums:s,cargando:t,error:n,getCancionesUsuario:u,getCancionesOrdenadasPorReproducciones:v,getAlbumesUsuario:b,getCancionesAlbum:c,eliminarAlbum:y,eliminarCancion:A,agregarCancion:_,actualizarPortadaAlbum:C,actualizarAlbum:x,crearAlbum:g,subirAlbumCompleto:async(a,e)=>{t.value=!0,n.value=null;try{const l=await g({nombre:a.nombre,tipo:a.tipo,num_canciones:e.length.toString(),duracion_total:a.duracionTotal},a.portada);for(let r=0;r<e.length;r++)await _(e[r],l.id,r+1);return l}catch(l){throw n.value="Ha ocurrido un error al crear el álbum y sus canciones",l}finally{t.value=!1}}}}export{j as A,q as u};
